// Google Cloud Platform Execution Profiles
// Supports both Life Sciences API and Batch

profiles {
    // Google Cloud Life Sciences (preferred for Nextflow)
    gcp {
        process {
            executor = 'google-lifesciences'
            
            // Resource specifications
            cpus   = { check_max( 4 * task.attempt, 'cpus' ) }
            memory = { check_max( 16.GB * task.attempt, 'memory' ) }
            time   = { check_max( 12.h * task.attempt, 'time' ) }
            
            // Process-specific resources
            withLabel: process_low {
                cpus   = { check_max( 2, 'cpus' ) }
                memory = { check_max( 4.GB * task.attempt, 'memory' ) }
                time   = { check_max( 4.h * task.attempt, 'time' ) }
                machineType = 'n1-standard-2'
            }
            
            withLabel: process_medium {
                cpus   = { check_max( 4, 'cpus' ) }
                memory = { check_max( 16.GB * task.attempt, 'memory' ) }
                time   = { check_max( 12.h * task.attempt, 'time' ) }
                machineType = 'n1-standard-4'
            }
            
            withLabel: process_high {
                cpus   = { check_max( 8, 'cpus' ) }
                memory = { check_max( 32.GB * task.attempt, 'memory' ) }
                time   = { check_max( 24.h * task.attempt, 'time' ) }
                machineType = 'n1-standard-8'
            }
        }
        
        // Google Cloud Life Sciences configuration
        google {
            // GCP project and location
            project = 'my-gcp-project'  // Change to your project ID
            location = 'us-central1'    // Change to your region
            
            // Disk configuration
            lifeSciences {
                bootDiskSize = 100.GB   // Size of boot disk
                preemptible = false      // Set to true for cost savings (interruptible instances)
            }
        }
        
        // Container configuration
        docker.enabled = true
        
        // Alternative: Use Singularity
        // singularity.enabled = true
        // singularity.cacheDir = 'gs://my-bucket/singularity-cache'
        
        // GCS storage configuration
        params {
            outdir = 'gs://my-bucket/scrnaseq-results'  // Change to your bucket
        }
    }
    
    // Google Cloud Batch (newer alternative to Life Sciences)
    gcp_batch {
        process {
            executor = 'google-batch'
            
            // Resource specifications
            cpus   = { check_max( 4 * task.attempt, 'cpus' ) }
            memory = { check_max( 16.GB * task.attempt, 'memory' ) }
            time   = { check_max( 12.h * task.attempt, 'time' ) }
            
            // Process-specific resources
            withLabel: process_low {
                cpus   = { check_max( 2, 'cpus' ) }
                memory = { check_max( 4.GB * task.attempt, 'memory' ) }
                time   = { check_max( 4.h * task.attempt, 'time' ) }
            }
            
            withLabel: process_medium {
                cpus   = { check_max( 4, 'cpus' ) }
                memory = { check_max( 16.GB * task.attempt, 'memory' ) }
                time   = { check_max( 12.h * task.attempt, 'time' ) }
            }
            
            withLabel: process_high {
                cpus   = { check_max( 8, 'cpus' ) }
                memory = { check_max( 32.GB * task.attempt, 'memory' ) }
                time   = { check_max( 24.h * task.attempt, 'time' ) }
            }
        }
        
        // Google Cloud Batch configuration
        google {
            project = 'my-gcp-project'  // Change to your project ID
            location = 'us-central1'    // Change to your region
            
            batch {
                bootDiskSize = 100.GB
                cpuPlatform = 'Intel Cascade Lake'  // Optional: specify CPU platform
            }
        }
        
        docker.enabled = true
        
        params {
            outdir = 'gs://my-bucket/scrnaseq-results'  // Change to your bucket
        }
    }
}
