// PBS/Torque HPC Scheduler Execution Profile
// For running on clusters with PBS Pro, OpenPBS, or Torque scheduler

profiles {
    pbs {
        process {
            executor = 'pbs'
            
            // Resource specifications (PBS-compatible)
            cpus   = { check_max( 4 * task.attempt, 'cpus' ) }
            memory = { check_max( 16.GB * task.attempt, 'memory' ) }
            time   = { check_max( 12.h * task.attempt, 'time' ) }
            
            // PBS directives
            clusterOptions = '-N scrnaseq'
            
            // Process-specific resources
            withLabel: process_low {
                cpus   = { check_max( 2, 'cpus' ) }
                memory = { check_max( 4.GB * task.attempt, 'memory' ) }
                time   = { check_max( 4.h * task.attempt, 'time' ) }
                queue  = 'standard'
            }
            
            withLabel: process_medium {
                cpus   = { check_max( 4, 'cpus' ) }
                memory = { check_max( 16.GB * task.attempt, 'memory' ) }
                time   = { check_max( 12.h * task.attempt, 'time' ) }
                queue  = 'standard'
            }
            
            withLabel: process_high {
                cpus   = { check_max( 8, 'cpus' ) }
                memory = { check_max( 32.GB * task.attempt, 'memory' ) }
                time   = { check_max( 24.h * task.attempt, 'time' ) }
                queue  = 'long'     // Use longer queue for intensive tasks
            }
        }
        
        // PBS executor configuration
        executor {
            name = 'pbs'
            queueSize = 20              // Number of jobs to queue at once
            submitRateLimit = '2 sec'   // Rate limit for job submission
            pollInterval = '30 sec'     // Check job status every 30 seconds
            dumpInterval = '5 min'      // Log task info every 5 minutes
        }
        
        // PBS-specific settings
        pbs {
            queueStatInterval = '30 sec'
            submitRateLimit = '2 sec'
        }
        
        // Container configuration for HPC
        // Most HPC clusters support Singularity
        singularity {
            enabled = true
            autoMounts = true
            cacheDir = "${System.getenv('HOME')}/.singularity-cache"
            pullTimeout = '20 min'
        }
        
        docker.enabled = false  // Usually not available on HPC
        conda.enabled = false   // Use containers instead
        
        // Local scratch space for temporary files
        // Note: Use $TMPDIR or cluster-specific scratch variable
        process.scratch = '$TMPDIR'  // Or use '/scratch/$USER' if available
    }
}
